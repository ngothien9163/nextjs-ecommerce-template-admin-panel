import React from 'react';
import { Button, Popconfirm, message } from 'antd';
import { DeleteOutlined } from '@ant-design/icons';
import { useDelete } from '@refinedev/core';

interface CustomDeleteButtonProps {
  recordItemId: string;
  resource: string;
  size?: 'small' | 'middle' | 'large';
  hideText?: boolean;
  onSuccess?: () => void;
}

export const CustomDeleteButton: React.FC<CustomDeleteButtonProps> = ({
  recordItemId,
  resource,
  size = 'small',
  hideText = true,
  onSuccess,
}) => {
  const { mutate: deleteOne, isLoading } = useDelete();

  const handleDelete = () => {
    deleteOne(
      {
        resource,
        id: recordItemId,
      },
      {
        onSuccess: () => {
          message.success('Xóa thành công!');
          onSuccess?.();
        },
        onError: (error) => {
          message.error(`Lỗi khi xóa: ${error.message}`);
        },
      }
    );
  };

  const getConfirmMessage = () => {
    const resourceMap: Record<string, string> = {
      'categories': 'danh mục',
      'products': 'sản phẩm',
      'profiles': 'người dùng',
      'blog_posts': 'bài viết',
      'blog_categories': 'danh mục blog',
      'blog_comments': 'bình luận',
      'blog_post_tags': 'tag bài viết',
      'tags': 'tag',
      'orders': 'đơn hàng',
      'product_variants': 'biến thể sản phẩm',
      'media': 'hình ảnh',
    };

    const resourceName = resourceMap[resource] || 'mục này';
    return `Bạn có chắc chắn muốn xóa ${resourceName} này không? Hành động này không thể hoàn tác.`;
  };

  return (
    <Popconfirm
      title="Xác nhận xóa"
      description={getConfirmMessage()}
      onConfirm={handleDelete}
      okText="Xóa"
      cancelText="Hủy"
      okType="danger"
      placement="topRight"
    >
      <Button
        type="text"
        size={size}
        danger
        loading={isLoading}
        icon={<DeleteOutlined />}
        title="Xóa"
      >
        {!hideText && 'Xóa'}
      </Button>
    </Popconfirm>
  );
};

